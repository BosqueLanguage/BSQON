declare namespace Main;

const re_SAFEIDENTIFIERCHAR: CRegex = /[a-zA-Z0-9-_]/c;
type EMAIL = CString of /${re_SAFEIDENTIFIERCHAR}+('.'${re_SAFEIDENTIFIERCHAR})* '@' (${re_SAFEIDENTIFIERCHAR}+ '.')+ [a-zA-Z]+ /c;

entity UserDTO {
    field email: Option<EMAIL>;
    invariant userEmailNotEmpty($email);
}

function userEmailNotEmpty(x: Option<EMAIL>) : Bool {
    if(x)@@none {
        return false;
    }
    return !x.value.empty() && x.value.size() <= 50n;
}

public function main(user: UserDTO): UserDTO{
	let x: Option<EMAIL> = some('jch270@uky.edu'<EMAIL>);

	assert \/(x@some !== user.email@some);

    return user;
}
